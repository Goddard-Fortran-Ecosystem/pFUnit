#!/usr/bin/env python

import argparse
import logging

import funit.parser

def main():
    text = 'Converts pFUnit .pf files into compilable Fortran source.'
    cli_parser = argparse.ArgumentParser(description=text, add_help=False)
    cli_parser.add_argument('-help', '-h', '--help', action='help',
                            help='Display this help and exit')
    cli_parser.add_argument('-markers', action='store_true',
                            help='Use linemarkers instead of #line directives')
    cli_parser.add_argument('-quiet', action='store_true',
                            help='Log less chatter to terminal')
    cli_parser.add_argument('source',
                            help='Filename of .pf file')
    cli_parser.add_argument('target',
                            help='Filename of generated .F90 file')
    arguments = cli_parser.parse_args()

    logger = logging.getLogger('funit')
    logger.addHandler(logging.StreamHandler())
    if arguments.quiet:
        logger.setLevel(logging.WARNING)
    else:
        logger.setLevel(logging.INFO)
    logger.info("Processing file " + arguments.source)
    proc = funit.parser.Processor()
    proc.run(arguments.source, arguments.target)
    logger.info(" ... Done.  Results in " + arguments.target)

if __name__ == "__main__":
    main()
